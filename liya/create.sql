CREATE TABLE IF NOT EXISTS transcripts(
id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
student_id INT REFERENCES students (id),
course_id INT REFERENCES courses (id),
gpa  float,
cgpa  float,
result_date      date,
created_at TIMESTAMP DEFAULT NOW(),
updated_at TIMESTAMP DEFAULT NOW(),
CONSTRAINT uq_student_course UNIQUE (student_id, course_id)
);
CREATE TABLE IF NOT EXISTS course_results (
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    transcript_id INT NOT NULL REFERENCES transcripts(id),
    course_id INT NOT NULL REFERENCES courses(id),
    grade DECIMAL(5,2) CHECK (grade BETWEEN 0 AND 100),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    CONSTRAINT uq_transcript_course UNIQUE (transcript_id, course_id)
);
CREATE TABLE IF NOT EXISTS tests (
id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
type  varchar(50) NOT NULL,
percentage  decimal(5,2) check (percentage between 0 and 100) NOT NULL,
student_id INTEGER NOT NULL REFERENCES students(id),
created_at TIMESTAMP DEFAULT NOW(),
updated_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE IF NOT EXISTS test_results( 
id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
course_result_id INT REFERENCES  course_results(id),
test_result_id     INT REFERENCES tests(id),
grade    decimal(5,2) check (grade between 0 and 100) NOT NULL,
created_at TIMESTAMP DEFAULT NOW(),
updated_at TIMESTAMP DEFAULT NOW()
);